{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Agronomist","text":"<p>Agronomist continuously monitors and reports on module updates, ensuring your IaC stays current, secure, and maintainable with minimal effort.</p>"},{"location":"#overview","title":"Overview","text":"<ul> <li>Scan <code>.hcl</code> and <code>.tf</code> files for <code>source</code> references with <code>?ref=</code>.</li> <li>Resolve latest versions via Git tags, GitHub API, or auto detection.</li> <li>Support blacklist filtering to ignore specific repositories, modules, or files.</li> <li>Generate JSON and Markdown reports.</li> <li>Optionally update files in place.</li> </ul>"},{"location":"#documentation","title":"Documentation","text":"<ul> <li>Getting Started</li> <li>CLI</li> <li>Configuration</li> <li>Resolvers</li> <li>Reports</li> <li>GitHub Action</li> <li>GitLab CI</li> <li>Testing</li> <li>Architecture</li> <li>API</li> <li>Development</li> <li>Troubleshooting</li> </ul>"},{"location":"api/","title":"API","text":"<p>Agronomist can be used as a Python library for custom automation.</p>"},{"location":"api/#basic-usage","title":"Basic usage","text":"<pre><code>from agronomist.scanner import scan_sources\nfrom agronomist.config import load_config\nfrom agronomist.github import GitHubClient\nfrom agronomist.git import GitClient\nfrom agronomist.gitlab import GitLabClient\nfrom agronomist.report import build_report, write_report\nfrom agronomist.markdown import write_markdown\n\n# Load configuration (includes categories and blacklist)\nconfig = load_config(\".agronomist.yaml\", root=\".\")\n\n# Scan sources with optional blacklist filters\nsources = scan_sources(\n    root=\"./infra\",\n    include=[\".tf\"],\n    exclude=[\".terraform/\"],\n    blacklist_repos=config.blacklist.repos,\n    blacklist_modules=config.blacklist.modules,\n    blacklist_files=config.blacklist.files,\n)\n\ngithub = GitHubClient(token=\"...\")\ngitlab = GitLabClient(base_url=\"https://gitlab.com\", token=\"...\")\nresolver = GitClient()\n\n# Resolve and build a report using custom logic with categories\nupdates = []  # Collect updates using resolver\nreport = build_report(root=\".\", updates=updates)\n</code></pre>"},{"location":"api/#common-functions-and-classes","title":"Common functions and classes","text":"<ul> <li><code>scan_sources</code> Scan files and return discovered sources. Supports optional blacklist filters for repos, modules, and files.</li> <li><code>load_config</code> Load configuration from YAML or JSON. Returns a <code>Config</code> object containing category rules and blacklist settings.</li> <li><code>GitHubClient</code> Resolve latest release and tags.</li> <li><code>GitClient</code> Resolve tags via <code>git ls-remote</code>.</li> <li><code>build_report</code> Build the report structure.</li> <li><code>write_report</code> Write JSON report to disk.</li> <li><code>write_markdown</code> Write Markdown report to disk.</li> <li><code>apply_updates</code> Apply updates to files.</li> </ul> <p>Refer to the source in <code>src/agronomist</code> for implementation details.</p>"},{"location":"architecture/","title":"Architecture","text":""},{"location":"architecture/#flow","title":"Flow","text":"<ol> <li>Scan source files under the root directory.</li> <li>Extract <code>source</code> references that contain <code>?ref=</code>.</li> <li>Resolve the latest version based on the selected resolver.</li> <li>Build a report of updates.</li> <li>Optionally apply updates in place.</li> </ol>"},{"location":"architecture/#components","title":"Components","text":"<ul> <li><code>scanner</code> Walks the file tree and finds module sources. Supports blacklist filters for repos, modules, and files.</li> <li><code>config</code> Loads category rules and blacklist settings for filtering and tagging updates.</li> <li><code>git</code> Resolves tags using Git.</li> <li><code>github</code> Resolves releases and tags using GitHub API.</li> <li><code>gitlab</code> Resolves tags using GitLab API when detected.</li> <li><code>report</code> Builds JSON report structures.</li> <li><code>markdown</code> Generates Markdown summaries.</li> <li><code>updater</code> Applies replacements to files.</li> </ul>"},{"location":"cli/","title":"CLI","text":"<p>Agronomist exposes two subcommands: <code>report</code> and <code>update</code>.</p>"},{"location":"cli/#commands","title":"Commands","text":""},{"location":"cli/#report","title":"Report","text":"<pre><code>agronomist report [options]\n</code></pre> <p>Scans Terraform/OpenTofu files and generates a JSON report with available module version updates. Does not modify any files.</p>"},{"location":"cli/#update","title":"Update","text":"<pre><code>agronomist update [options]\n</code></pre> <p>Scans Terraform/OpenTofu files, identifies available module version updates, and applies them directly to the source files. Also generates a JSON report.</p>"},{"location":"cli/#options","title":"Options","text":""},{"location":"cli/#requiredcommon-options","title":"Required/Common Options","text":"Option Description Default <code>--root</code> Root directory to scan for <code>.tf</code> and <code>.hcl</code> files. <code>.</code> (current directory) <code>--config</code> Path to <code>.agronomist.yaml</code> or JSON configuration file. <code>.agronomist.yaml</code>"},{"location":"cli/#filtering-options","title":"Filtering Options","text":"Option Description <code>--include</code> Glob patterns to include in scan. Can be specified multiple times. <code>--exclude</code> Glob patterns to exclude from scan. Can be specified multiple times. <p>Note: Additional filtering via blacklist can be configured in <code>.agronomist.yaml</code> to permanently ignore specific repositories, modules, or files. See Configuration for details.</p>"},{"location":"cli/#api-authentication","title":"API &amp; Authentication","text":"Option Description Default <code>--github-token</code> Authentication token for GitHub API (PAT - Personal Access Token). Can also be set via <code>GITHUB_TOKEN</code> environment variable. Read from <code>GITHUB_TOKEN</code> env var <code>--gitlab-token</code> Authentication token for GitLab API (PAT - Personal Access Token). Can also be set via <code>GITLAB_TOKEN</code> environment variable. Read from <code>GITLAB_TOKEN</code> env var <code>--token</code> Shared fallback token for GitHub and GitLab APIs when specific tokens are not provided. Not set <code>--github-base-url</code> GitHub API base URL (useful for GitHub Enterprise). <code>https://api.github.com</code> <code>--resolver</code> Version resolution strategy. See Resolution Strategies. <code>git</code> <code>--validate-token</code> Validate API token before processing (useful for CI/CD pipelines). Does not scan if invalid. <code>false</code>"},{"location":"cli/#output-options","title":"Output Options","text":"Option Description Default <code>--output</code> Path to write JSON report. <code>report.json</code> <code>--markdown</code> Path to write human-readable Markdown report. If omitted, no Markdown is generated. Not set ## Resolution Strategies <p>The <code>--resolver</code> option determines how Agronomist queries for the latest module version:</p>"},{"location":"cli/#git-default","title":"<code>git</code> (default)","text":"<ul> <li>Uses <code>git ls-remote --tags</code> to fetch the latest release from Git repositories</li> <li>Works with GitHub, GitLab, Gitea, and other Git-compatible servers</li> <li>Does not require authentication</li> <li>Best for: Most use cases, especially private repositories without API access</li> </ul>"},{"location":"cli/#github","title":"<code>github</code>","text":"<ul> <li>Uses GitHub API to fetch releases and tags</li> <li>Only works with GitHub.com (or GitHub Enterprise with <code>--github-base-url</code>)</li> <li>Requires valid GitHub token for better rate limits</li> <li>Best for: Public repositories or when you need GitHub-specific features</li> </ul>"},{"location":"cli/#auto","title":"<code>auto</code>","text":"<ul> <li>Automatically selects the best resolver based on repository host</li> <li>Uses GitLab API for GitLab repositories</li> <li>Uses GitHub API for GitHub repositories</li> <li>Falls back to Git for other repositories</li> <li>Requires tokens if accessing private repositories</li> <li>Best for: Mixed environments with multiple Git hosting platforms</li> </ul>"},{"location":"cli/#environment-variables","title":"Environment Variables","text":"<ul> <li><code>GITHUB_TOKEN</code> - Default authentication token for GitHub API. Used when <code>--github-token</code> is not specified.</li> <li><code>GITLAB_TOKEN</code> - Default authentication token for GitLab API. Used when <code>--gitlab-token</code> is not specified.</li> </ul>"},{"location":"cli/#exit-codes","title":"Exit Codes","text":"<ul> <li><code>0</code> - Success</li> <li><code>1</code> - Error (invalid token, scan failure, etc.)</li> </ul>"},{"location":"cli/#examples","title":"Examples","text":""},{"location":"cli/#basic-report-generation","title":"Basic Report Generation","text":"<pre><code># Generate report for current directory\nagronomist report\n\n# Generate report for specific directory\nagronomist report --root ./infrastructure\n\n# Generate report and save to custom location\nagronomist report --output ./reports/versions.json\n</code></pre>"},{"location":"cli/#with-markdown-output","title":"With Markdown Output","text":"<pre><code># Generate both JSON and Markdown reports\nagronomist report --markdown report.md --output report.json\n\n# Generate Markdown report for documentation\nagronomist report --root ./terraform --markdown UPDATES.md\n</code></pre>"},{"location":"cli/#using-environment-variables","title":"Using Environment Variables","text":"<pre><code># Use GITHUB_TOKEN from environment (GitHub API)\nexport GITHUB_TOKEN=\"ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxx\"\nagronomist report --root . --resolver github\n\n# Or pass token inline\nGITHUB_TOKEN=\"ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxx\" agronomist report --root . --resolver github\n\n# Use GITLAB_TOKEN from environment (GitLab API)\nexport GITLAB_TOKEN=\"glpat_xxxxxxxxxxxxxxxxxxxxxxxxxxxx\"\nagronomist report --root . --resolver auto\n</code></pre>"},{"location":"cli/#using-github-enterprise","title":"Using GitHub Enterprise","text":"<pre><code># Point to GitHub Enterprise API with token\nexport GITHUB_TOKEN=\"ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxx\"\nagronomist report --github-base-url https://github.enterprise.com/api/v3 --resolver github\n\n# Or pass token directly\nagronomist report --github-base-url https://github.enterprise.com/api/v3 --resolver github --github-token $GITHUB_TOKEN\n</code></pre>"},{"location":"cli/#filtering-files","title":"Filtering Files","text":"<pre><code># Include only specific patterns\nagronomist report --include \"**/*.tf\" --include \"**/*.hcl\"\n\n# Exclude specific patterns\nagronomist report --exclude \"**/test/**\" --exclude \"**/*_test.tf\"\n\n# Combine include and exclude\nagronomist report --include \"**/*.tf\" --exclude \"**/examples/**\"\n</code></pre>"},{"location":"cli/#validating-token-before-processing","title":"Validating Token Before Processing","text":"<pre><code># Validate token in CI/CD before running expensive scan (GitHub)\nagronomist report --github-token $GITHUB_TOKEN --validate-token\n\n# Validate token in CI/CD before running expensive scan (GitLab)\nagronomist report --gitlab-token $GITLAB_TOKEN --validate-token\n\n# If token is invalid, exit with code 1\n</code></pre>"},{"location":"cli/#updating-modules","title":"Updating Modules","text":"<pre><code># Update all modules and generate report\nagronomist update --output report.json\n\n# Update with Markdown report\nagronomist update --markdown UPDATES.md --output report.json\n\n# Update specific directory with token\nagronomist update --root ./terraform --resolver github --github-token $GITHUB_TOKEN\n\n# Update without generating report files (useful for CI/CD)\nagronomist update --no-report\n</code></pre>"},{"location":"configuration/","title":"Configuration","text":"<p>Agronomist reads category rules from a YAML or JSON file. By default, it looks for <code>.agronomist.yaml</code> in the root directory.</p>"},{"location":"configuration/#example","title":"Example","text":""},{"location":"configuration/#yaml-format","title":"YAML Format","text":"<pre><code>categories:\n  - name: aws\n    repo_patterns:\n      - \"*/terraform-aws-*\"\n      - \"*/opentofu-aws-*\"\n      - \"*/tofu-aws-*\"\n  - name: database\n    repo_patterns:\n      - \"*/terraform-*-mysql-*\"\n      - \"*/opentofu-*-mysql-*\"\n      - \"*/tofu-*-mysql-*\"\n      - \"*/terraform-*-mariadb-*\"\n      - \"*/opentofu-*-mariadb-*\"\n      - \"*/tofu-*-mariadb-*\"\n      - \"*/terraform-*-postgres-*\"\n      - \"*/opentofu-*-postgres-*\"\n      - \"*/tofu-*-postgres-*\"\n  - name: security\n    repo_patterns:\n      - \"*/terraform-*-security-*\"\n      - \"*/opentofu-*-security-*\"\n      - \"*/tofu-*-security-*\"\n  - name: monitoring\n    repo_patterns:\n      - \"*/terraform-*-monitoring-*\"\n      - \"*/opentofu-*-monitoring-*\"\n      - \"*/tofu-*-monitoring-*\"\n\nblacklist:\n  repos:\n    - \"*/terraform-legacy-*\"\n    - \"*/deprecated-*\"\n  modules:\n    - \"old-modules/*\"\n  files:\n    - \"**/legacy/**\"\n    - \"**/deprecated/**\"\n</code></pre>"},{"location":"configuration/#json-format","title":"JSON Format","text":"<pre><code>{\n  \"categories\": [\n    {\n      \"name\": \"aws\",\n      \"repo_patterns\": [\n        \"*/terraform-aws-*\",\n        \"*/opentofu-aws-*\"\n      ]\n    },\n    {\n      \"name\": \"database\",\n      \"repo_patterns\": [\n        \"*/terraform-*-mysql-*\",\n        \"*/terraform-*-postgres-*\"\n      ]\n    }\n  ],\n  \"blacklist\": {\n    \"repos\": [\n      \"*/terraform-legacy-*\",\n      \"*/deprecated-*\"\n    ],\n    \"modules\": [\n      \"old-modules/*\"\n    ],\n    \"files\": [\n      \"**/legacy/**\",\n      \"**/deprecated/**\"\n    ]\n  }\n}\n</code></pre>"},{"location":"configuration/#fields","title":"Fields","text":""},{"location":"configuration/#categories","title":"Categories","text":"Field Type Required Description <code>categories</code> list Yes List of category rules <code>name</code> string Yes Category name (assigned to matching updates) <code>repo_patterns</code> list[string] No Glob patterns to match repository names/URLs <code>module_patterns</code> list[string] No Glob patterns to match module names"},{"location":"configuration/#blacklist","title":"Blacklist","text":"Field Type Required Description <code>blacklist</code> object No Blacklist configuration to ignore specific resources <code>repos</code> list[string] No Glob patterns to ignore repositories <code>modules</code> list[string] No Glob patterns to ignore modules <code>files</code> list[string] No Glob patterns to ignore files"},{"location":"configuration/#behavior","title":"Behavior","text":"<ul> <li>Pattern matching: Uses Python <code>fnmatch</code> rules (not regex). Supports <code>*</code>, <code>?</code>, <code>[abc]</code>, <code>[!abc]</code></li> <li>Matching logic: </li> <li>If <code>repo_patterns</code> matches the repository, category is assigned</li> <li>If <code>module_patterns</code> matches the module name, category is assigned</li> <li>First matching rule wins</li> <li>Uncategorized: Updates that don't match any rule are labeled <code>uncategorized</code></li> <li>Optional patterns: If <code>repo_patterns</code> or <code>module_patterns</code> are omitted or empty, they are skipped</li> <li>Blacklist: Resources matching blacklist patterns are completely ignored and won't appear in reports or updates</li> <li>File formats: Both YAML (<code>.yaml</code>, <code>.yml</code>) and JSON (<code>.json</code>) are supported</li> </ul>"},{"location":"development/","title":"Development","text":""},{"location":"development/#prerequisites","title":"Prerequisites","text":"<p>Before setting up the development environment, ensure you have:</p> <ul> <li>Python 3.10+ - Required by project (<code>pyproject.toml</code>)</li> <li>Poetry - Dependency and environment manager (https://python-poetry.org/)</li> <li>Git - Version control and required for git resolver testing</li> <li>Docker (optional) - For containerized builds using <code>make build-docker</code></li> </ul>"},{"location":"development/#install-poetry","title":"Install Poetry","text":"<pre><code>curl -sSL https://install.python-poetry.org | python3 -\n</code></pre> <p>Then add Poetry to your PATH: <pre><code>export PATH=\"$HOME/.local/bin:$PATH\"\n</code></pre></p>"},{"location":"development/#development-setup","title":"Development Setup","text":""},{"location":"development/#1-clone-and-install-dependencies","title":"1. Clone and Install Dependencies","text":"<pre><code>git clone https://github.com/Ops-Talks/agronomist.git\ncd agronomist\npoetry install\n</code></pre> <p>This installs:</p> <ul> <li>Core dependencies: <code>requests</code>, <code>pyyaml</code></li> <li>Dev dependencies: <code>ruff</code>, <code>black</code>, <code>pytest</code>, <code>pre-commit</code>, <code>taskipy</code>, <code>mkdocs</code>, <code>mkdocs-material</code></li> </ul>"},{"location":"development/#2-verify-installation","title":"2. Verify Installation","text":"<pre><code>poetry run agronomist --help\n</code></pre>"},{"location":"development/#task-runner-taskipy","title":"Task Runner (taskipy)","text":"<p>Agronomist uses taskipy for convenient task management. All tasks are defined in <code>pyproject.toml</code>.</p>"},{"location":"development/#available-tasks","title":"Available Tasks","text":"Task Command Description <code>lint</code> <code>poetry run task lint</code> Run ruff check, ruff format, and black <code>format</code> <code>poetry run task format</code> Auto-format code (ruff + black) <code>test</code> <code>poetry run task test</code> Run pytest test suite <code>check</code> <code>poetry run task check</code> Run linters + tests (recommended before commit) <code>pre-commit-install</code> <code>poetry run task pre-commit-install</code> Install pre-commit hooks <code>pre-commit-run</code> <code>poetry run task pre-commit-run</code> Run pre-commit on all files <code>pre-commit</code> <code>poetry run task pre-commit</code> Install and run pre-commit hooks <code>report</code> <code>poetry run task report</code> Run agronomist on itself (example) <code>update</code> <code>poetry run task update</code> Update agronomist's own dependencies (example)"},{"location":"development/#quick-start","title":"Quick Start","text":"<pre><code># Format and lint code\npoetry run task check\n\n# Install pre-commit hooks\npoetry run task pre-commit-install\n\n# Run only tests\npoetry run task test\n</code></pre>"},{"location":"development/#linting-and-formatting","title":"Linting and Formatting","text":""},{"location":"development/#tools","title":"Tools","text":"<ul> <li>ruff - Fast Python linter (checks style, imports, bugs)</li> <li>black - Code formatter (enforces consistent style)</li> </ul>"},{"location":"development/#configuration","title":"Configuration","text":"<p>Both tools are configured in <code>pyproject.toml</code>:</p> <pre><code>[tool.ruff]\nline-length = 100\ntarget-version = \"py310\"\n\n[tool.black]\nline-length = 100\ntarget-version = [\"py310\"]\n</code></pre>"},{"location":"development/#manual-commands","title":"Manual Commands","text":"<pre><code># Check code style\npoetry run ruff check .\n\n# Auto-format with ruff\npoetry run ruff format .\n\n# Auto-format with black\npoetry run black .\n\n# Combined check and format (via task)\npoetry run task check\n</code></pre>"},{"location":"development/#testing","title":"Testing","text":""},{"location":"development/#run-all-tests","title":"Run All Tests","text":"<pre><code>poetry run pytest\n</code></pre>"},{"location":"development/#run-specific-test","title":"Run Specific Test","text":"<pre><code>poetry run pytest tests/test_cli.py\n</code></pre>"},{"location":"development/#run-tests-with-coverage","title":"Run Tests with Coverage","text":"<pre><code>poetry run pytest --cov=agronomist --cov-report=html\n</code></pre>"},{"location":"development/#test-configuration","title":"Test Configuration","text":"<p>Tests use pytest. Configuration is managed in <code>pyproject.toml</code> (if present) or pytest defaults.</p>"},{"location":"development/#pre-commit-hooks","title":"Pre-commit Hooks","text":"<p>Pre-commit hooks automatically run linters and formatters before each commit.</p>"},{"location":"development/#install-hooks","title":"Install Hooks","text":"<pre><code>poetry run task pre-commit-install\n</code></pre> <p>This installs Git hooks defined in <code>.pre-commit-config.yaml</code>.</p>"},{"location":"development/#run-hooks-manually","title":"Run Hooks Manually","text":"<pre><code>poetry run task pre-commit-run\n</code></pre>"},{"location":"development/#bypass-hooks-not-recommended","title":"Bypass Hooks (not recommended)","text":"<pre><code>git commit --no-verify\n</code></pre>"},{"location":"development/#cicd-quality-checks","title":"CI/CD (Quality Checks)","text":"<p>The GitHub Actions workflow automatically runs quality checks:</p> <ul> <li>Trigger: On every push to <code>main</code> and pull requests</li> <li>Command: <code>poetry run task check</code> (linters + tests)</li> </ul> <p>Local equivalent: <pre><code>poetry run task check\n</code></pre></p> <p>Always run this locally before pushing to ensure CI will pass.</p>"},{"location":"development/#building","title":"Building","text":""},{"location":"development/#using-make-recommended","title":"Using Make (Recommended)","text":"<pre><code>make build-docker\n</code></pre> <p>Advantages:</p> <ul> <li>Isolated Docker environment (no local Python version conflicts)</li> <li>Consistent build across machines</li> <li>Cleans up automatically</li> </ul> <p>Output: <code>dist/agronomist-*.whl</code> and <code>dist/agronomist-*.tar.gz</code></p>"},{"location":"development/#using-poetry-directly","title":"Using Poetry Directly","text":"<pre><code>poetry build\n</code></pre> <p>Advantages:</p> <ul> <li>No Docker required</li> <li>Faster build</li> </ul> <p>Output: Same as above</p>"},{"location":"development/#build-artifacts","title":"Build Artifacts","text":"<p>Both methods generate:</p> <ul> <li><code>.whl</code> - Wheel distribution (for <code>pipx install</code>)</li> <li><code>.tar.gz</code> - Source distribution</li> </ul>"},{"location":"development/#documentation","title":"Documentation","text":""},{"location":"development/#build-docs-locally","title":"Build Docs Locally","text":"<pre><code>poetry run mkdocs serve\n</code></pre> <p>Starts a local server at <code>http://localhost:8000</code> with live reloading.</p>"},{"location":"development/#using-make","title":"Using Make","text":"<pre><code>make docs-serve\n</code></pre>"},{"location":"development/#features","title":"Features","text":"<ul> <li>Built with MkDocs + Material Theme</li> <li>Source files: <code>docs/</code></li> <li>Auto-generated navigation from directory structure</li> </ul>"},{"location":"development/#release-process","title":"Release Process","text":""},{"location":"development/#prerequisites_1","title":"Prerequisites","text":"<ul> <li>All tests must pass (<code>poetry run task check</code>)</li> <li>Changes committed and merged to <code>main</code></li> <li>Version number decided (follow Semantic Versioning)</li> </ul>"},{"location":"development/#steps","title":"Steps","text":""},{"location":"development/#1-update-version","title":"1. Update Version","text":"<p>Edit <code>pyproject.toml</code>:</p> <pre><code>[tool.poetry]\nversion = \"X.Y.Z\"\n</code></pre>"},{"location":"development/#2-commit-version-bump","title":"2. Commit Version Bump","text":"<pre><code>git add pyproject.toml\ngit commit -m \"Bump version to X.Y.Z\"\ngit push\n</code></pre>"},{"location":"development/#3-create-release-tag","title":"3. Create Release Tag","text":"<pre><code>git tag vX.Y.Z\ngit push origin vX.Y.Z\n</code></pre> <p>Or using Make: <pre><code>make release TAG=vX.Y.Z\n</code></pre></p>"},{"location":"development/#github-actions-release-workflow","title":"GitHub Actions Release Workflow","text":"<p>Once the tag is pushed, <code>.github/workflows/release.yml</code> automatically:</p> <ol> <li>Runs <code>poetry build</code></li> <li>Creates a GitHub Release</li> <li>Uploads artifacts (<code>.whl</code> and <code>.tar.gz</code>)</li> </ol> <p>Result: Users can install the release:</p> <pre><code># Download from https://github.com/Ops-Talks/agronomist/releases/latest\npipx install agronomist-X.Y.Z-py3-none-any.whl\n</code></pre>"},{"location":"development/#makefile-targets","title":"Makefile Targets","text":"<p>Agronomist provides a Makefile with convenience targets:</p> <pre><code>make help              # Show all available targets\nmake build             # Build locally with Poetry\nmake build-docker      # Build in Docker (recommended)\nmake clean             # Remove build artifacts\nmake lint              # Run linters\nmake format            # Format code\nmake test              # Run tests\nmake check             # Lint + test\nmake docs-serve        # Serve documentation locally\nmake pre-commit        # Run pre-commit hooks\nmake release TAG=vX.Y.Z # Create release tag\n</code></pre>"},{"location":"development/#project-structure","title":"Project Structure","text":"<pre><code>agronomist/\n\u251c\u2500\u2500 src/\n\u2502   \u2514\u2500\u2500 agronomist/\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u251c\u2500\u2500 cli.py              # CLI entry point\n\u2502       \u251c\u2500\u2500 config.py           # Configuration loader (categories &amp; blacklist)\n\u2502       \u251c\u2500\u2500 models.py           # Data models (SourceRef, etc.)\n\u2502       \u251c\u2500\u2500 scanner.py          # File scanner\n\u2502       \u251c\u2500\u2500 categorizer.py      # Update categorizer\n\u2502       \u251c\u2500\u2500 resolver*.py        # Version resolvers (git, github, gitlab)\n\u2502       \u251c\u2500\u2500 reporter.py         # Report generation\n\u2502       \u2514\u2500\u2500 updater.py          # Update application\n\u251c\u2500\u2500 tests/                      # Test suite\n\u251c\u2500\u2500 docs/                       # Documentation (MkDocs)\n\u251c\u2500\u2500 pyproject.toml             # Project metadata and dependencies\n\u251c\u2500\u2500 Makefile                   # Build and development targets\n\u251c\u2500\u2500 Dockerfile                 # Docker build configuration\n\u251c\u2500\u2500 .github/workflows/         # GitHub Actions workflows\n\u2514\u2500\u2500 README.md\n</code></pre>"},{"location":"development/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/#poetry-lock-issues","title":"Poetry Lock Issues","text":"<p>If <code>poetry install</code> fails:</p> <pre><code>rm poetry.lock\npoetry install\n</code></pre>"},{"location":"development/#pre-commit-hook-failures","title":"Pre-commit Hook Failures","text":"<p>If hooks fail unexpectedly:</p> <pre><code># Check hook configuration\ncat .pre-commit-config.yaml\n\n# Run hooks with verbose output\npoetry run pre-commit run --all-files --verbose\n\n# Bypass and commit (temporary, not recommended)\ngit commit --no-verify\n</code></pre>"},{"location":"development/#import-errors-when-running-tests","title":"Import Errors When Running Tests","text":"<p>Ensure you're using the Poetry environment:</p> <pre><code># Wrong (system Python):\npython -m pytest\n\n# Correct (Poetry venv):\npoetry run pytest\n</code></pre>"},{"location":"development/#docker-build-issues","title":"Docker Build Issues","text":"<pre><code># Clean Docker state\ndocker system prune -a\n\n# Rebuild with verbose output\nmake build-docker VERBOSE=1\n</code></pre>"},{"location":"development/#code-style-guidelines","title":"Code Style Guidelines","text":"<ul> <li>Line length: 100 characters</li> <li>Imports: Organized via ruff (auto-formatted)</li> <li>Python version: 3.10+</li> <li>Type hints: Encouraged (Python 3.10+ supports modern syntax)</li> </ul>"},{"location":"development/#contributing","title":"Contributing","text":"<ol> <li>Create a branch from <code>main</code></li> <li>Make changes and test: <code>poetry run task check</code></li> <li>Push and open a pull request</li> <li>GitHub Actions CI will run automatically</li> <li>Once approved and green, merge to <code>main</code></li> </ol> <p>Release tags are created manually after merging to trigger the release workflow.</p>"},{"location":"getting-started/","title":"Getting Started","text":""},{"location":"getting-started/#requirements","title":"Requirements","text":"<ul> <li>Python 3.10 or newer</li> <li>Git installed (used for <code>git ls-remote</code>)</li> <li>GitHub token recommended to avoid rate limits when using <code>--resolver github</code> (<code>GITHUB_TOKEN</code> or <code>--github-token</code>)</li> <li>GitLab token recommended for private GitLab repositories when using <code>--resolver auto</code> (<code>GITLAB_TOKEN</code> or <code>--gitlab-token</code>)</li> </ul>"},{"location":"getting-started/#install","title":"Install","text":""},{"location":"getting-started/#using-pipx-recommended","title":"Using pipx (recommended)","text":""},{"location":"getting-started/#from-github-releases-pre-built","title":"From GitHub Releases (pre-built)","text":"<p>Download the latest version from Releases:</p> <pre><code>pipx install agronomist-X.Y.Z-py3-none-any.whl\n</code></pre>"},{"location":"getting-started/#from-source-build-locally","title":"From Source (build locally)","text":""},{"location":"getting-started/#with-make-simplest","title":"With Make (simplest)","text":"<pre><code>git clone https://github.com/Ops-Talks/agronomist.git\ncd agronomist\nmake build-docker\npipx install dist/agronomist-*-py3-none-any.whl\n</code></pre>"},{"location":"getting-started/#with-poetry","title":"With Poetry","text":"<pre><code>git clone https://github.com/Ops-Talks/agronomist.git\ncd agronomist\npoetry build\npipx install dist/agronomist-*-py3-none-any.whl\n</code></pre>"},{"location":"getting-started/#for-local-development","title":"For local development","text":"<p>If you want to develop the project:</p> <pre><code>poetry install\n</code></pre>"},{"location":"getting-started/#run-a-report","title":"Run a report","text":""},{"location":"getting-started/#with-pipx","title":"With pipx","text":"<pre><code>agronomist report --root . --output report.json\n</code></pre>"},{"location":"getting-started/#with-poetry_1","title":"With poetry","text":"<pre><code>poetry run agronomist report --root . --output report.json\n</code></pre>"},{"location":"getting-started/#apply-updates","title":"Apply updates","text":""},{"location":"getting-started/#with-pipx_1","title":"With pipx","text":"<pre><code>agronomist update --root . --output report.json\n</code></pre>"},{"location":"getting-started/#with-poetry_2","title":"With poetry","text":"<pre><code>poetry run agronomist update --root . --output report.json\n</code></pre>"},{"location":"getting-started/#generate-markdown-report","title":"Generate Markdown report","text":""},{"location":"getting-started/#with-pipx_2","title":"With pipx","text":"<pre><code>agronomist report --root . --markdown report.md --output report.json\n</code></pre>"},{"location":"getting-started/#with-poetry_3","title":"With poetry","text":"<pre><code>poetry run agronomist report --root . --markdown report.md --output report.json\n</code></pre>"},{"location":"getting-started/#next-steps","title":"Next steps","text":"<ul> <li>Review CLI options</li> <li>Configure categories in Configuration</li> <li>CI runs <code>poetry run task check</code> on pushes to <code>main</code> and on pull requests.</li> <li>Releases are created by pushing a SemVer tag (e.g. <code>v0.3.8</code>).</li> </ul>"},{"location":"github-action/","title":"GitHub Action","text":""},{"location":"github-action/#available-cli-options","title":"Available CLI Options","text":"<p>When running Agronomist in GitHub Actions, you can use these CLI options:</p> <ul> <li><code>--github-token</code> GitHub token for API calls (or use <code>GITHUB_TOKEN</code> env var).</li> <li><code>--root</code> Root directory to scan. Default: <code>.</code></li> <li><code>--include</code> Glob patterns to include. Can be specified multiple times.</li> <li><code>--exclude</code> Glob patterns to exclude. Can be specified multiple times.</li> <li><code>--output</code> Report file name. Default: <code>report.json</code></li> <li><code>--markdown</code> Markdown report file (optional).</li> <li><code>--github-base-url</code> GitHub API base URL (for GitHub Enterprise).</li> <li><code>--resolver</code> Version resolver strategy: <code>git</code>, <code>github</code>, or <code>auto</code>. Default: <code>git</code></li> <li><code>--config</code> Path to configuration file. Default: <code>.agronomist.yaml</code></li> <li><code>--no-report</code> Skip generating report files (useful for CI/CD pipelines).</li> <li><code>--validate-token</code> Validate API token before processing.</li> </ul>"},{"location":"github-action/#example-workflow","title":"Example Workflow","text":"<p>Install Agronomist from GitHub Releases and run the CLI directly in your workflow:</p> <pre><code>name: Agronomist Updates\non:\n  schedule:\n    - cron: \"0 7 * * 1\"\n  workflow_dispatch: {}\n\njobs:\n  update:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - name: Install Agronomist\n        run: |\n          AGRONOMIST_VERSION=\"v0.5.3\"\n          WHEEL=\"agronomist-${AGRONOMIST_VERSION#v}-py3-none-any.whl\"\n          curl -L -o \"$WHEEL\" \"https://github.com/Ops-Talks/agronomist/releases/download/${AGRONOMIST_VERSION}/${WHEEL}\"\n          pip install \"$WHEEL\"\n      - name: Run Agronomist\n        run: |\n          agronomist update --root . --no-report\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n</code></pre> <p>See examples/workflows/agronomist-ci.yml for a full example.</p>"},{"location":"gitlab-ci/","title":"GitLab CI","text":"<p>This project includes a GitLab pipeline to run Agronomist using GitLab Runners.</p>"},{"location":"gitlab-ci/#requirements","title":"Requirements","text":"<ul> <li>GitLab Runner with Docker or shell executor.</li> <li>GitLab token stored in GitLab CI variables.</li> </ul>"},{"location":"gitlab-ci/#variables","title":"Variables","text":"<ul> <li><code>GITLAB_TOKEN</code> Token used by Agronomist for GitLab API calls and MR creation.</li> <li><code>AGRONOMIST_VERSION</code> Agronomist release tag (e.g. <code>v0.5.0</code>).</li> <li><code>AGRONOMIST_ROOT</code> Root directory to scan. Default: <code>.</code></li> <li><code>AGRONOMIST_RESOLVER</code> Resolver strategy: <code>git</code>, <code>github</code>, or <code>auto</code>.</li> <li><code>AGRONOMIST_CONFIG</code> Path to configuration file (supports category rules and blacklist filters). Default: <code>.agronomist.yaml</code>.</li> <li><code>MR_BODY</code> Merge Request description. Default: <code>Updates generated by Agronomist.</code>.</li> <li><code>MR_TARGET_BRANCH</code> Target branch for MR. Default: <code>$CI_DEFAULT_BRANCH</code>.</li> </ul> <p>Note: <code>MR_BRANCH</code> and <code>MR_TITLE</code> are generated dynamically using <code>CI_COMMIT_REF_SLUG</code> and <code>CI_PIPELINE_ID</code> to avoid conflicts.</p>"},{"location":"gitlab-ci/#pipeline-overview","title":"Pipeline overview","text":"<ul> <li><code>update</code> stage runs Agronomist, applies changes, and automatically creates a Merge Request if updates are found.</li> <li>Workflow rules: Only runs on <code>main</code> branch via manual trigger (web) or scheduled pipelines.</li> <li>Dynamic branch naming: Uses <code>CI_COMMIT_REF_SLUG</code> and <code>CI_PIPELINE_ID</code> to create unique MR branches and avoid conflicts.</li> <li>Git configuration: Automatically configures Git to use GitLab token for accessing private repositories.</li> <li>MR cleanup: Deletes existing MR branch before pushing to avoid conflicts when re-running the pipeline.</li> <li>No report files: Uses <code>--no-report</code> flag to keep the repository clean without generating report.json/report.md.</li> </ul>"},{"location":"gitlab-ci/#example-pipeline","title":"Example pipeline","text":"<pre><code>stages:\n  - update\n\nworkflow:\n  name: \"Agronomist\"\n  rules:\n    - if: '$CI_PIPELINE_SOURCE == \"web\" &amp;&amp; $CI_COMMIT_REF_NAME == \"main\"'\n    - if: '$CI_PIPELINE_SOURCE == \"schedule\" &amp;&amp; $CI_COMMIT_REF_NAME == \"main\"'\n    - when: never\n\nvariables:\n  AGRONOMIST_VERSION: \"v0.5.0\"\n  AGRONOMIST_ROOT: \".\"\n  AGRONOMIST_RESOLVER: \"git\"\n  AGRONOMIST_CONFIG: \".agronomist.yaml\"\n  MR_BODY: \"Updates generated by Agronomist.\"\n  MR_TARGET_BRANCH: \"$CI_DEFAULT_BRANCH\"\n\nupdate:\n  stage: update\n  image: python:3.12\n  rules:\n    - if: '$CI_PIPELINE_SOURCE == \"web\" &amp;&amp; $CI_COMMIT_REF_NAME == \"main\"'\n      when: manual\n    - if: '$CI_PIPELINE_SOURCE == \"schedule\" &amp;&amp; $CI_COMMIT_REF_NAME == \"main\"'\n      when: always\n  script:\n    - apt-get update -qq &amp;&amp; apt-get install -y -qq git curl\n    - |\n      WHEEL=\"agronomist-${AGRONOMIST_VERSION#v}-py3-none-any.whl\"\n      curl -sSL -o \"$WHEEL\" \"https://github.com/Ops-Talks/agronomist/releases/download/${AGRONOMIST_VERSION}/${WHEEL}\"\n      pip install -q \"$WHEEL\"\n    - |\n      if [ -n \"$GITLAB_TOKEN\" ]; then\n        git config --global url.\"https://oauth2:${GITLAB_TOKEN}@${CI_SERVER_HOST}/\".insteadOf \"https://${CI_SERVER_HOST}/\"\n      fi\n    - |\n      MR_BRANCH=\"agronomist/updates-${CI_COMMIT_REF_SLUG}-${CI_PIPELINE_ID}\"\n      MR_TITLE=\"[Agronomist] - New modules version identified\"\n      export MR_BRANCH\n      export MR_TITLE\n    - |\n      TOKEN_ARG=\"\"\n      if [ -n \"$GITLAB_TOKEN\" ]; then\n        TOKEN_ARG=\"--gitlab-token $GITLAB_TOKEN\"\n      fi\n      agronomist update --root \"$AGRONOMIST_ROOT\" \\\n        --config \"$AGRONOMIST_CONFIG\" \\\n        --resolver \"$AGRONOMIST_RESOLVER\" \\\n        --no-report \\\n        $TOKEN_ARG\n    - |\n      if [ -z \"$GITLAB_TOKEN\" ]; then\n        echo \"GITLAB_TOKEN not set. Skipping MR creation.\"\n        exit 0\n      fi\n\n      if [ -z \"$(git status --porcelain)\" ]; then\n        echo \"No changes to commit.\"\n        exit 0\n      fi\n\n      git config user.email \"ci@agronomist\"\n      git config user.name \"agronomist-bot\"\n      git checkout -b \"$MR_BRANCH\"\n      git add -u\n      git commit -m \"$MR_TITLE\"\n      git remote set-url origin \"https://oauth2:${GITLAB_TOKEN}@${CI_SERVER_HOST}/${CI_PROJECT_PATH}.git\"\n      git push origin --delete \"$MR_BRANCH\" 2&gt;/dev/null || true\n      git push -u origin \"$MR_BRANCH\"\n\n      curl --silent --show-error --fail \\\n        --request POST \\\n        --header \"PRIVATE-TOKEN: ${GITLAB_TOKEN}\" \\\n        --form \"source_branch=${MR_BRANCH}\" \\\n        --form \"target_branch=${MR_TARGET_BRANCH}\" \\\n        --form \"title=${MR_TITLE}\" \\\n        --form \"description=${MR_BODY}\" \\\n        \"${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/merge_requests\" || true\n</code></pre> <p>For a full pipeline, see examples/workflows/.gitlab-ci.yml.</p>"},{"location":"reports/","title":"Reports","text":"<p>Agronomist can produce JSON and Markdown reports.</p>"},{"location":"reports/#json-report","title":"JSON report","text":"<p>The JSON report is always produced and written to <code>--output</code>.</p> <p>Example structure:</p> <pre><code>{\n  \"generated_at\": \"2026-02-17T12:34:56Z\",\n  \"root\": \".\",\n  \"updates\": [\n    {\n      \"repo\": \"owner/repo\",\n      \"repo_host\": \"github.com\",\n      \"repo_url\": \"https://github.com/owner/repo\",\n      \"module\": \"modules/vpc\",\n      \"current_ref\": \"v1.2.0\",\n      \"latest_ref\": \"v1.4.1\",\n      \"strategy\": \"latest\",\n      \"category\": \"aws\",\n      \"files\": [\"infra/prod/vpc/terragrunt.hcl\"],\n      \"replacements\": [\n        {\"from\": \"source = ...\", \"to\": \"source = ...\"}\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"reports/#markdown-report","title":"Markdown report","text":"<p>Use <code>--markdown</code> to generate a human readable summary.</p> <p>Example:</p> <pre><code>poetry run agronomist report --root . --markdown report.md --output report.json\n</code></pre> <p>Example output:</p> <pre><code># Agronomist Report\n\n**Generated at:** 2026-02-17T12:34:56Z\n**Root:** `.`\n\n## Summary\n\n- **Total updates:** 2\n- **Affected repositories:** 2\n- **Affected modules:** 2\n\n## Updates by Repository\n\n### terraform-aws/vpc (github.com)\n\n#### Module: `vpc`\n\n**v1.2.0 -&gt; v1.4.1**\n- Category: `aws`\n- Affected files: 1\n  - `infra/prod/vpc/terragrunt.hcl`\n\n### terraform-aws/rds (github.com)\n\n#### Module: `rds`\n\n**v3.0.0 -&gt; v3.1.0**\n- Category: `database`\n- Affected files: 1\n  - `infra/prod/db/terragrunt.hcl`\n</code></pre>"},{"location":"resolvers/","title":"Resolvers","text":"<p>Agronomist supports three resolver strategies controlled by <code>--resolver</code>.</p>"},{"location":"resolvers/#git-default","title":"git (default)","text":"<p>Uses <code>git ls-remote --tags</code> to list tags and select the latest tag.</p>"},{"location":"resolvers/#github","title":"github","text":"<p>Uses the GitHub API to resolve the latest release or tag. Provide a token with <code>--github-token</code> or <code>GITHUB_TOKEN</code>.</p>"},{"location":"resolvers/#auto","title":"auto","text":"<p>Chooses the resolver based on repository host: - GitLab URLs use the GitLab API (token via <code>--gitlab-token</code> or <code>GITLAB_TOKEN</code>). - GitHub URLs use the GitHub API (token via <code>--github-token</code> or <code>GITHUB_TOKEN</code>). - Other URLs fall back to Git.</p>"},{"location":"resolvers/#github-base-url","title":"GitHub base URL","text":"<p>Use <code>--github-base-url</code> for GitHub Enterprise or custom API endpoints.</p>"},{"location":"testing/","title":"Testing Guide","text":"<p>This guide covers the testing infrastructure for Agronomist workflows, including unit tests, integration tests, and CI/CD validation.</p>"},{"location":"testing/#overview","title":"Overview","text":"<p>The test suite ensures that the multi-PR workflow logic functions correctly across different scenarios:</p> <ul> <li>Unit Tests: Test individual bash functions and jq queries</li> <li>Integration Tests: Test the complete multi-PR flow end-to-end</li> <li>Workflow Validation: Validate YAML syntax and shell scripts</li> </ul>"},{"location":"testing/#test-structure","title":"Test Structure","text":"<pre><code>test/\n\u251c\u2500\u2500 unit/                       # BATS unit tests\n\u2502   \u2514\u2500\u2500 test_multi_pr.bats     # Multi-PR logic tests\n\u251c\u2500\u2500 integration/                # Integration tests\n\u2502   \u2514\u2500\u2500 test_multi_pr_flow.sh  # End-to-end workflow simulation\n\u2514\u2500\u2500 fixtures/                   # Test data\n    \u251c\u2500\u2500 report_single_module.json\n    \u251c\u2500\u2500 report_multiple_modules.json\n    \u2514\u2500\u2500 report_empty.json\n</code></pre>"},{"location":"testing/#prerequisites","title":"Prerequisites","text":""},{"location":"testing/#install-test-dependencies","title":"Install Test Dependencies","text":"<p>Using Makefile (Recommended): <pre><code>make install-test-deps\n</code></pre></p> <p>Manual Installation:</p> <p>macOS: <pre><code>brew install bats-core jq shellcheck\n</code></pre></p> <p>Ubuntu/Debian: <pre><code>sudo apt-get update\nsudo apt-get install -y bats jq shellcheck git\n</code></pre></p> <p>Windows (WSL): <pre><code>sudo apt-get update\nsudo apt-get install -y bats jq shellcheck git\n</code></pre></p>"},{"location":"testing/#running-tests","title":"Running Tests","text":""},{"location":"testing/#run-all-tests","title":"Run All Tests","text":"<pre><code>make test\n</code></pre>"},{"location":"testing/#run-unit-tests-only","title":"Run Unit Tests Only","text":"<pre><code>make test-unit\n# or\nbats test/unit/*.bats\n</code></pre>"},{"location":"testing/#run-integration-tests-only","title":"Run Integration Tests Only","text":"<pre><code>make test-integration\n# or\nbash test/integration/test_multi_pr_flow.sh\n</code></pre>"},{"location":"testing/#run-linting","title":"Run Linting","text":"<pre><code>make lint\n</code></pre>"},{"location":"testing/#unit-tests","title":"Unit Tests","text":"<p>Unit tests use BATS (Bash Automated Testing System) to test individual components.</p>"},{"location":"testing/#example-test-cases","title":"Example Test Cases","text":"<p>Extract modules from JSON: <pre><code>@test \"extract unique modules from report.json\" {\n    modules=$(jq -r '.updates[].module' report.json | sort -u)\n    module_count=$(echo \"$modules\" | wc -l)\n    [ \"$module_count\" -eq 2 ]\n}\n</code></pre></p> <p>Branch naming: <pre><code>@test \"create valid branch name from module with slashes\" {\n    module=\"weyderfs/terraform-aws-modules//vpc/security-group\"\n    branch_name=\"agronomist/update-$(echo \"$module\" | sed 's/\\//-/g')\"\n    [ \"$branch_name\" = \"agronomist/update-weyderfs-terraform-aws-modules--vpc-security-group\" ]\n}\n</code></pre></p>"},{"location":"testing/#running-individual-tests","title":"Running Individual Tests","text":"<pre><code>bats test/unit/test_multi_pr.bats --filter \"extract modules\"\n</code></pre>"},{"location":"testing/#integration-tests","title":"Integration Tests","text":"<p>Integration tests simulate the complete multi-PR workflow:</p> <ol> <li>Create test Git repository</li> <li>Add files with old module versions</li> <li>Simulate Agronomist updates</li> <li>Execute multi-PR logic</li> <li>Validate branches and commits</li> </ol>"},{"location":"testing/#test-scenarios","title":"Test Scenarios","text":"<ul> <li>Multiple Modules: Creates 3 separate branches for 3 different modules</li> <li>Single Module: Validates single-module workflow</li> <li>Empty Report: Handles case with no updates</li> </ul>"},{"location":"testing/#output-example","title":"Output Example","text":"<pre><code>[INFO] Starting multi-PR integration tests\n[INFO] Setting up test repository in /tmp/tmp.abc123\n[INFO] Test repository initialized\n[INFO] Simulating agronomist update\n[INFO] Files updated\n[INFO] Testing multi-PR logic with report_multiple_modules.json\n[INFO] Found 3 unique modules\n[INFO] Created temporary commit: a1b2c3d\n[INFO] Processing module: weyderfs/terraform-aws-modules//vpc/security-group\n[INFO] Created branch: agronomist/update-weyderfs-terraform-aws-modules--vpc-security-group\n[INFO] Processing module: hashicorp/terraform-provider-aws\n[INFO] Created branch: agronomist/update-hashicorp-terraform-provider-aws\n[INFO] Processing module: terraform-aws-modules/rds/aws\n[INFO] Created branch: agronomist/update-terraform-aws-modules-rds-aws\n[INFO] Processed 3 modules successfully\n[INFO] All integration tests passed! \u2713\n</code></pre>"},{"location":"testing/#test-fixtures","title":"Test Fixtures","text":"<p>Fixtures are located in <code>test/fixtures/</code> and provide sample <code>report.json</code> files:</p>"},{"location":"testing/#single-module-report_single_modulejson","title":"Single Module (<code>report_single_module.json</code>)","text":"<pre><code>{\n  \"updates\": [\n    {\n      \"module\": \"weyderfs/terraform-aws-modules//vpc/security-group\",\n      \"current_ref\": \"v1.2.0\",\n      \"latest_ref\": \"v1.3.0\",\n      \"files\": [\"infra/main.tf\"]\n    }\n  ]\n}\n</code></pre>"},{"location":"testing/#multiple-modules-report_multiple_modulesjson","title":"Multiple Modules (<code>report_multiple_modules.json</code>)","text":"<pre><code>{\n  \"updates\": [\n    {\"module\": \"module-a\", \"files\": [\"file1.tf\"]},\n    {\"module\": \"module-b\", \"files\": [\"file2.tf\"]},\n    {\"module\": \"module-c\", \"files\": [\"file3.tf\"]}\n  ]\n}\n</code></pre>"},{"location":"testing/#empty-report-report_emptyjson","title":"Empty Report (<code>report_empty.json</code>)","text":"<pre><code>{\n  \"updates\": []\n}\n</code></pre>"},{"location":"testing/#cicd-integration","title":"CI/CD Integration","text":"<p>Tests run automatically on GitHub Actions:</p>"},{"location":"testing/#workflow-githubworkflowstest-workflowsyml","title":"Workflow: <code>.github/workflows/test-workflows.yml</code>","text":"<p>Triggers: - Push to <code>main</code> or <code>develop</code> branches - Pull requests to <code>main</code> - Changes to <code>examples/workflows/**</code> or <code>test/**</code> - Manual workflow dispatch</p> <p>Jobs: 1. unit-tests: Runs BATS unit tests 2. integration-tests: Runs integration test suite 3. workflow-validation: Validates YAML syntax 4. shellcheck: Lints shell scripts</p>"},{"location":"testing/#view-test-results","title":"View Test Results","text":"<pre><code># View latest test run\ngh run list --workflow=test-workflows.yml\n\n# View specific run\ngh run view &lt;run-id&gt;\n</code></pre>"},{"location":"testing/#writing-new-tests","title":"Writing New Tests","text":""},{"location":"testing/#adding-unit-tests","title":"Adding Unit Tests","text":"<p>Create new test in <code>test/unit/test_multi_pr.bats</code>:</p> <pre><code>@test \"describe what you're testing\" {\n    # Setup\n    expected_value=\"something\"\n\n    # Execute\n    actual_value=$(your_command_here)\n\n    # Assert\n    [ \"$actual_value\" = \"$expected_value\" ]\n}\n</code></pre>"},{"location":"testing/#adding-integration-tests","title":"Adding Integration Tests","text":"<p>Add new test function in <code>test/integration/test_multi_pr_flow.sh</code>:</p> <pre><code>test_your_scenario() {\n    log_info \"Testing your scenario\"\n\n    # Setup test data\n    # Run logic\n    # Validate results\n\n    if [ condition ]; then\n        log_error \"Test failed\"\n        return 1\n    fi\n\n    log_info \"Test passed\"\n    return 0\n}\n</code></pre> <p>Call from <code>main()</code>:</p> <pre><code>if ! test_your_scenario; then\n    log_error \"Your scenario test failed\"\n    exit 1\nfi\n</code></pre>"},{"location":"testing/#debugging-tests","title":"Debugging Tests","text":""},{"location":"testing/#enable-verbose-output","title":"Enable Verbose Output","text":"<p>BATS: <pre><code>bats --verbose-run test/unit/test_multi_pr.bats\n</code></pre></p> <p>Integration: <pre><code>bash -x test/integration/test_multi_pr_flow.sh\n</code></pre></p>"},{"location":"testing/#keep-test-artifacts","title":"Keep Test Artifacts","text":"<p>Modify <code>cleanup()</code> in integration test:</p> <pre><code>cleanup() {\n    log_info \"Test directory: $TEST_DIR\"\n    # Comment out to keep artifacts:\n    # rm -rf \"$TEST_DIR\"\n}\n</code></pre>"},{"location":"testing/#common-issues","title":"Common Issues","text":""},{"location":"testing/#bats-not-found","title":"BATS not found","text":"<pre><code>make install-test-deps\n</code></pre>"},{"location":"testing/#jq-command-not-found","title":"jq command not found","text":"<pre><code>sudo apt-get install jq\n# or\nbrew install jq\n</code></pre>"},{"location":"testing/#permission-denied","title":"Permission denied","text":"<pre><code>chmod +x test/integration/test_multi_pr_flow.sh\n</code></pre>"},{"location":"testing/#best-practices","title":"Best Practices","text":"<ol> <li>Isolation: Each test should be independent</li> <li>Cleanup: Always clean up test artifacts</li> <li>Assertions: Use clear, descriptive assertions</li> <li>Fixtures: Use fixtures for complex test data</li> <li>Documentation: Comment complex test logic</li> </ol>"},{"location":"testing/#contributing-tests","title":"Contributing Tests","text":"<p>When contributing workflow changes:</p> <ol> <li>\u2705 Add unit tests for new bash functions</li> <li>\u2705 Add integration tests for new workflows</li> <li>\u2705 Update fixtures if report structure changes</li> <li>\u2705 Run <code>make test</code> before submitting PR</li> <li>\u2705 Ensure CI passes</li> </ol>"},{"location":"testing/#resources","title":"Resources","text":"<ul> <li>BATS Documentation</li> <li>jq Manual</li> <li>ShellCheck Wiki</li> <li>Bash Testing Tutorial</li> </ul>"},{"location":"troubleshooting/","title":"Troubleshooting","text":""},{"location":"troubleshooting/#git-is-not-installed","title":"Git is not installed","text":"<p>Agronomist uses <code>git ls-remote</code>. Install Git and ensure it is on your PATH.</p>"},{"location":"troubleshooting/#githubgitlab-token-errors","title":"GitHub/GitLab token errors","text":"<ul> <li><code>401</code> means the token is invalid or expired.</li> <li><code>403</code> means the token lacks permissions or rate limit was hit.</li> <li>For GitHub, ensure the token has <code>public_repo</code> or <code>repo</code> scope.</li> <li>For GitLab, ensure the token has <code>read_api</code> scope.</li> </ul> <p>Tip: Use <code>--validate-token</code> to check token validity before processing.</p>"},{"location":"troubleshooting/#no-updates-found","title":"No updates found","text":"<ul> <li>Ensure your sources use <code>?ref=</code> in the <code>source</code> string.</li> <li>Confirm the repository has tags.</li> <li>Check if the repository is blacklisted in <code>.agronomist.yaml</code>.</li> </ul>"},{"location":"troubleshooting/#pre-commit-python-version-errors","title":"Pre-commit Python version errors","text":"<p>If pre-commit cannot find <code>python3.10</code>, install it or set:</p> <pre><code>default_language_version:\n  python: python3\n</code></pre>"},{"location":"troubleshooting/#github-api-base-url-issues","title":"GitHub API base URL issues","text":"<p>For GitHub Enterprise, set <code>--github-base-url</code> to your API endpoint (e.g., <code>https://github.company.com/api/v3</code>).</p>"},{"location":"troubleshooting/#gitlab-api-issues","title":"GitLab API issues","text":"<p>For self-hosted GitLab instances, use <code>--gitlab-token</code> and ensure the base URL is correct (default: <code>https://gitlab.com</code>).</p>"},{"location":"troubleshooting/#resolver-issues","title":"Resolver issues","text":"<ul> <li>git resolver: Requires Git installed and network access to repositories.</li> <li>github/gitlab resolvers: Require valid tokens and API access.</li> <li>auto resolver: Falls back to git if API resolvers fail. Check logs for details.</li> </ul>"}]}